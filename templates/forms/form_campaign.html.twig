{% extends 'base.html.twig' %}

{% block body %}

{#   {{dump(app.flashes)}}#}
    <div class="container">
        <div class="card">
            <div class="card-header">
                {% if mode == 'edit' %} Edit campaign
                {% elseif  mode == 'create'%}Create campaign {% endif %}
            </div>

        <div class="card-body">
            {{ form_start(formCampaign) }}

            <div class="row">
                <div class="col-8">
                    {{ form_row(formCampaign.campaign) }}
                </div>
                <div class="col-4">
                    {{ form_row(formCampaign.imisprojectnr) }}
                    <p>IMIS project number: <span class="imis-display"></span></p>
                </div>
            </div>

            {{ form_row(formCampaign.memo) }}


        <button type="submit" class="btn btn-primary">
            {% if mode == 'edit' %}
            Confirm edit{% elseif mode == 'create' %}
            Submit new campaign {% endif %}
        </button>

        {{ form_end(formCampaign) }}

        </div>
    </div>
    </div>


{% endblock %}

{% block javascripts %}
    <script src="/EasyAutocomplete-1.3.5/jquery.easy-autocomplete.js"></script>


    <script src="{{ '/bundles/fosjsrouting/js/router.min.js' }}"></script>
    <script src="{{ path('fos_js_routing_js', { callback: 'fos.Router.setData' }) }}"></script>

    <script>
        // function addAutocompleteForCampaign(){

            var optionsTitle = {
                url: function(phrase){
                    return Routing.generate("searchImisProjects", {searchParameter: phrase});

                },
                getValue: function (element) {
                    return element.StandardTitle;
                },
                ajaxSettings: {
                    dataType: "json",
                    method: "POST",
                    data: {
                        dataType: "json"
                    }
                },

                preparePostData: function(data) {
                    data.phrase = $('#campaign_campaign').val();
                    $('span.imis-display').text('');
                    return data;
                },
                list: {
                    maxNumberOfElements: 10,
                    onChooseEvent: function () {
                        var selectedItemValue = $('#campaign_campaign').getSelectedItemData().ProID;
                        $('#campaign_imisprojectnr').val(selectedItemValue);
                        $('span.imis-display').text(selectedItemValue);
                    }
                },

                requestDelay: 400
            };



            $("#campaign_campaign").easyAutocomplete(optionsTitle);



    </script>



{% endblock %}