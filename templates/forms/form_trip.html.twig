{% extends 'base.html.twig' %}
{% form_theme formTrip _self %}

 {% block stylesheets %}

     <link rel="stylesheet" href="/jQueryUI/jquery-ui.css">
     <style>
         div[id^=block_trip_tripinvestigators_] {
             margin-bottom: 3px!important;
         }
     </style>




 {% endblock %}

{% block body %}
    <div class="container">
        {{form_start(formTrip)}}

        <div class="row">
            <div class="col">
                {{ form_row(formTrip.startdate) }}
            </div>
            <div class="col">
                {{ form_row(formTrip.enddate) }}
            </div>
        </div>



{#        <div class="row">#}
        {{ form_widget(formTrip) }}
{#        </div>#}
        <button type="submit" class="btn btn-primary">Submit modifications</button>

        {{form_end(formTrip)}}
    </div>


{% endblock %}

{% block _trip_tripinvestigators_entry_widget %}

<div class="form-group" id="block_{{ id }}">


               <div class="row">
                <div class="col">
                    {{ form_widget(form.firstname) }}
                </div>
                <div class="col">
                    {{ form_widget(form.surname) }}
                </div>
                <div class="col">
                    <button type="button" class="btn btn-danger" id="remove-tripinvestigator"
                            data-action="delete" data-target="#block_{{ id }}" >
                        <i class="fa fa-trash"></i>
                    </button>
                </div>
    </div>
</div>




{% endblock %}

{% block _trip_tripinvestigators_widget %}
        {{ form_widget(form) }}
    <input type="hidden" id="widgets-counter" value="0">
    <div class="form-group">
        <button type="button" id="add-tripinvestigator" class="btn btn-primary">Add investigator</button>
    </div>

{% endblock %}

{# Here we force the form to not display label 0, 1,... 0only widget in row...#}
{% block _trip_tripinvestigators_entry_row %}
    {{ form_widget(form) }}
{% endblock %}

{% block javascripts %}
    <script>


         $(document).ready(function(){
             $("[id$=firstname]").prop('autocomplete', 'off');
         });

        $('#add-tripinvestigator').click(function(){
            const index = +$('#widgets-counter').val();
            console.log(index);
            const tmpl = $('#trip_tripinvestigators').data('prototype').replace(/__name__/g, index);
            // console.log(tmpl);
            $('#trip_tripinvestigators').append(tmpl);

            // $("[id^=block_trip_tripinvestigators]").removeClass('col-6');
            //
            // $("[id^=block_trip_tripinvestigators]").addClass('col-6');
            $("[id$=firstname]").prop('autocomplete', 'off');

            $('#widgets-counter').val(index+1);

            handleDeleteButtons();
        })

        function updateCounter(){
            const count = $('#trip_tripinvestigators div.form-group').length;
            console.log('count' + count);
            $('#widgets-counter').val(count);
        }

        function handleDeleteButtons(){
            $('button[data-action="delete"]').click(function(){
                const target=this.dataset.target;
                // console.log(target);
                $(target).remove();
            })
        }
        //
        updateCounter();
        handleDeleteButtons();
    </script>

    <script src="/jquery-ui-1.12.1/jquery-ui.js"></script>
    <script src="/jquery-ui-1.12.1//external/jquery/jquery.js"></script>
    <script>
        $(function(){
            var availableTags = [
                "ActionScript",
                "AppleScript",
                "Asp",
                "BASIC",
                "C",
                "C++",
                "Clojure",
                "COBOL",
                "ColdFusion",
                "Erlang",
                "Fortran",
                "Groovy",
                "Haskell",
                "Java",
                "JavaScript",
                "Lisp",
                "Perl",
                "PHP",
                "Python",
                "Ruby",
                "Scala",
                "Scheme"
            ];
            $( "[id$=firstname]" ).autocomplete({
                source: availableTags
            });
        });

    </script>

{% endblock %}