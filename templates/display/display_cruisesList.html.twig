{% extends 'base.html.twig' %}

{% block title %}Cruises{% endblock %}

{% block stylesheets %}
    <link rel="stylesheet" href="/css/datatables.min.css">
    <link rel="stylesheet" href="/css/fixedHeader.dataTables.min.css">

{% endblock %}


{% block body %}


    <div class="container">

        <h1>Cruises</h1>
{#    <div class="table-responsive">#}
    <table class="table-hover table-bordered display" id="myDataTable" width="100%">
        <thead>
        {% set headerRow = "
            <tr>
                <th>Cruise Plan Code</th>
                <th>Campaigns</th>
                <th>Start date (first trip)</th>
                <th>End date (last trip)</th>
                <th>Principal Investigator</th>
                <th>Number of<br>Trips</th>
            </tr>"
        %}

        {{ headerRow | raw}}

        </thead>

        <tfoot>

        {{ headerRow | raw}} {# Variable containing columns headers, see above #}
        </tfoot>


    </table>
    </div>
{#    </div>#}


{% endblock %}

{% block javascripts %}

{#    <script src="/js/dataTables.fixedHeader.min.js"></script>#}
{#    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.8.4/moment.min.js"></script>#}
{#    <script src="https://cdn.datatables.net/plug-ins/1.10.20/sorting/datetime-moment.js"></script>#}

    <script type="text/javascript" src="/js/datatables.min.js"></script>
    {#<script type="text/javascript" src="/js/myDataTable/tableSearchHeaders.js"></script>#}
    <script src="{{ asset('bundles/fosjsrouting/js/router.min.js') }}"></script>
    <script src="{{ path('fos_js_routing_js', { callback: 'fos.Router.setData' }) }}"></script>

    <script type="text/javascript">
        $(document).ready(function() {
            $('#myDataTable').DataTable( {
                "ajax": "api/getcruises",
                "order": [[ 0, "desc" ]],
                "columns": [
                    { "data": "plancode" },
                    { "data": "campaigns",
                        "name": "campaigns",
                        "defaultContent": ""
                    },
                    { "data": "startdate" },
                    { "data": "enddate" },
                    { "data": "PrincipalInvestigator" },
                    { "data": "numberOfTrips" },
                    { "data": "CruiseID" }
                ],
                "columnDefs": [
                    {
                        "targets": 1,
                        "render": function (data, type, row) {
                            var campaignOutput = '';
                            var campaignRouteName =  'campaign_details' ;
                            if (Array.isArray(data) && data.length) {
                                for (var i = 0; i < data.length; i++) {
                                    campaignOutput += '<a href="' + Routing.generate(campaignRouteName, {campaignId: data[i]['campaignid']}) + '" title="Open Campaign">' +
                                        '<i class="fa fa-map-marker" aria-hidden="true"></i>&nbsp;'
                                        + data[i]['campaign'] + '</a><br/>';
                                }
                                return campaignOutput ;
                            }
                        }
                    },
                    {
                        "targets": 0,
                        "render": function (data, type, row) {
                            cruiseOutput = '<a href="' + Routing.generate('cruise_details', {cruiseId: row.CruiseID}) + '" title="Open Cruise">'
                                         + data + '</a>';
                            return cruiseOutput;
                        }
                    },

                    {
                        "targets": -1,
                       "visible": false
                    }
                ],
            } );
        } );
    </script>

{% endblock %}
