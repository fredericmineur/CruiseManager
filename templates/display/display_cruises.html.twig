{% extends 'base.html.twig' %}

{% block title %}Cruises{% endblock %}

{% block stylesheets %}<link rel="stylesheet" href="/css/fixedHeader.dataTables.min.css">{% endblock %}


{% block body %}
{#    {% for cruise in cruises %}#}
{#        <p>{{ cruise.destination }}</p>#}
{#    {% endfor %}#}

        <h1>Cruises</h1>

{#    <div class="table-responsive">#}
    <table class="table-hover table-bordered display" id="myDataTable">
        <thead>
        {% set headerRow = "
            <tr>
                <th>ID</th>
                <th>Principal Investigator</th>
                <th>Start date</th>
                <th>End date</th>
                <th>Destination</th>
                <th>Memo</th>
                <th>Plan Code</th>
                <th>Ship</th>
                <th>Campaigns</th>
                <th>Number of<br>Trips</th>
            </tr>"  %}
{#        <tr>#}
{#            <th>ID</th>#}
{#            <th>Principal Investigator</th>#}
{#            <th>Start date</th>#}
{#            <th>End date</th>#}
{#            <th>Destination</th>#}
{#            <th>Memo</th>#}
{#            <th>Plan Code</th>#}
{#            <th>Ship</th>#}
{#            <th>Campaigns</th>#}
{#            <th>Number of<br>Trips</th>#}
{#        </tr>#}

        {{ headerRow | raw}}

        </thead>
        <tbody>

            {% for cruise in cruises  %}
                <tr>
                    <td>{{ cruise.cruiseid}}</td>
                    <td>
                        {% set arrayOrphanIds = [0, 264, 549, 556, 637] %}
                        {% if cruise.principalinvestigator is not empty and cruise.principalinvestigator.investigatorid not in arrayOrphanIds %}

                        {{ cruise.principalinvestigator.firstname }}
                        {{ cruise.principalinvestigator.surname}}
                    {% endif %}
                    </td>
                    <td>{{ cruise.startdate|date('d/m/Y')}}</td>
                    <td>{{ cruise.enddate|date('d/m/Y')}}</td>
                    <td>{{ cruise.destination}}</td>
                    <td>{{ cruise.memo}}</td>
                    <td>{{ cruise.plancode}}</td>
                    <td>{{ cruise.ship}}</td>
                    <td>{% for singleCampaign in cruise.campaign %}
                            {{ singleCampaign.campaign  }}<br>
                            <a href="{{ path('campaign_details', {'campaignId':singleCampaign.campaignid}) }}"><i>More</i></a><br>
                        {% endfor %}</td>
{#                    <td>{% for trip in cruise.trips %}{{ trip.destinationarea }}<br>{% endfor %}</td>#}
                    <td>{{ cruise.trips | length }}</td>

                </tr>


            {% endfor %}
        </tbody>
        <tfoot>
{#                <tr>#}
{#                    <th>ID</th>#}
{#                    <th>Principal Investigator</th>#}
{#                    <th>Start date</th>#}
{#                    <th>End date</th>#}
{#                    <th>Destination</th>#}
{#                    <th>Memo</th>#}
{#                    <th>Plan Code</th>#}
{#                    <th>Ship</th>#}
{#                    <th>Campaigns</th>#}
{#                    <th>Number of<br>Trips</th>#}
{#                </tr>#}

                {{ headerRow | raw}}
        </tfoot>


    </table>
{#    </div>#}


{#    {{ dump(investigators) }}#}

{% endblock %}

{% block javascripts %}

{#    <script src="/js/dataTables.fixedHeader.min.js"></script>#}
{#    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.8.4/moment.min.js"></script>#}
{#    <script src="https://cdn.datatables.net/plug-ins/1.10.20/sorting/datetime-moment.js"></script>#}
    <script type="text/javascript">
        $(document).ready( function () {
            //allow sorting date
            // $.fn.dataTable.moment("D/M/YYYY");

            //Add another header below the first
            $('#myDataTable thead tr').clone().appendTo('#myDataTable thead');

            //Transform the second header row to have the search input fields
            $('#myDataTable thead tr:odd th').each( function () {
                $(this).html('<input type="text" placeholder="Search" />');
            });

            //Create the table
            var table =
                $('#myDataTable').DataTable({
                // "dom": '<"top"i>rt<"bottom"flp><"clear">',
                // fixedHeader: {
                //     footer: true
                // }
                // "scrollX": true
            });

            //Hide the generic search field
            $('#myDataTable_filter').hide();


            // Apply the search on every column
            table.columns().every( function () {
                var that = this;

                $( 'input', this.header() ).on( 'keyup change clear', function () {
                    if ( that.search() !== this.value ) {
                        that
                            .search( this.value )
                            .draw();
                    }
                } );
            } );


            //prevent that clicking on the search field sort the column
            //https://stackoverflow.com/questions/31677257/datatables-only-allow-sorting-with-buttons

            $('#myDataTable thead input').on('click', function(e){
                e.stopPropagation();
            });

        } );
    </script>

{% endblock %}
